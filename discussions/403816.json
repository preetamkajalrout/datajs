[
  {
    "Id": "944034",
    "ThreadId": "403816",
    "Html": "\r\n<p>I'm trying to use datajs 1.0.3 to update&nbsp; sharepoint listitems. The save is working, but datajs always calls my error callback with returns an error message saying 'mediaType' is null or not an object</p>\r\n<p>The code looks like this:<br>\r\n&nbsp;&nbsp; var requestOptions = {<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; requestUri: spListItem.__metadata.uri,<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; method: &quot;POST&quot;,<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data: createObjectFromSPListItem(spListItem),<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; headers: {<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;If-Match&quot;: spListItem.__metadata.etag,<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;X-HTTP-Method&quot;: &quot;MERGE&quot;</p>\r\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OData.request(requestOptions,<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function (xhr) {<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; alert('saved');<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function (xhr) {<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; alert('save failed' &#43; xhr.message &#43; &quot; &quot; &#43; xhr.response.statusText); //xhr message says 'mediaType' is null or not an object'<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</p>\r\n<p><br>\r\nThe request in fiddler looks like this :<br>\r\nPOST <a href=\"http://mysitename.sharepoint.com/TeamSite/_vti_bin/listdata.svc/Caregories(2\">\r\nhttp://mysitename.sharepoint.com/TeamSite/_vti_bin/listdata.svc/Caregories(2</a>) HTTP/1.1<br>\r\nContent-Type: application/json;odata=verbose<br>\r\nAccept-Language: en-us<br>\r\nIf-Match: W/&quot;2&quot;<br>\r\ndataserviceversion: 1.0<br>\r\nx-http-method: MERGE<br>\r\nAccept: application/json,application/json;odata=verbose<br>\r\nmaxdataserviceversion: 2.0<br>\r\nReferer: <a href=\"http://mysitename.sharepoint.com/TeamSite/SitePages/Home.aspx\">\r\nhttp://mysitename.sharepoint.com/TeamSite/SitePages/Home.aspx</a><br>\r\nAccept-Encoding: gzip, deflate<br>\r\nUser-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; GTB7.4; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; MS-RTC LM 8; InfoPath.3; .NET4.0C; .NET4.0E)<br>\r\nHost: mysitename.sharepoint.com<br>\r\nContent-Length: 60<br>\r\nConnection: Keep-Alive<br>\r\nPragma: no-cache<br>\r\nCookie: FedAuth=xxxxxxxxA&#43;; Ribbon.Library=1276846|0|8|-94849213; Ribbon.Read=1276846|-1|0|-94849213</p>\r\n<p>{&quot;Id&quot;:2,&quot;Title&quot;:&quot;cat2wdfa&quot;,&quot;Modified&quot;:&quot;2012-11-19T07:52:49&quot;}</p>\r\n<p><br>\r\nand the response like this:<br>\r\nHTTP/1.1 204 No Content<br>\r\nCache-Control: no-cache<br>\r\nETag: W/&quot;3&quot;<br>\r\nServer: Microsoft-IIS/7.5<br>\r\nSPRequestGuid: ff1d9128-e48a-4e0f-ad8c-c5477177f50b<br>\r\nX-SharePointHealthScore: 0<br>\r\nDataServiceVersion: 1.0;<br>\r\nX-AspNet-Version: 2.0.50727<br>\r\nX-Powered-By: ASP.NET<br>\r\nMicrosoftSharePointTeamServices: 14.0.0.6120<br>\r\nP3P: CP=&quot;ALL IND DSP COR ADM CONo CUR CUSo IVAo IVDo PSA PSD TAI TELo OUR SAMo CNT COM INT NAV ONL PHY PRE PUR UNI&quot;<br>\r\nDate: Mon, 19 Nov 2012 15:54:57 GMT</p>\r\n<p>&nbsp;</p>\r\n<p>I tried it on both my on prem site and on office 365 with the same error. How can I use datajs to update lists in Sharepoint without getting the error returned?</p>\r\n<p>&nbsp;</p>\r\n<p>(</p>\r\n",
    "PostedDate": "2012-11-19T08:20:13.867-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "944787",
    "ThreadId": "403816",
    "Html": "\r\n<p>So i traced though the datajs code a bit today to try to understand this&nbsp; problem.</p>\r\n<p>In the invokdeRequest function it calls handlerRead passing in the response. In ie8/9 the response has no headers at all because ie strips away headers when there is a 204 response. In chrome the headers from&nbsp;sharepoint are preserved, but there is infact\r\n no Content-Type header returned.</p>\r\n<p><br>\r\nin handlerRead it gets the content type like this:</p>\r\n<p>&nbsp;var cType = getContentType(response);</p>\r\n<p>ctype is now null since the response has no Content-Type header.</p>\r\n<p>it then has a line that says</p>\r\n<pre> if (handlerAccepts(handler, cType)) {</pre>\r\n<p><br>\r\nso it calls handlerAccepts with&nbsp; a null ctype</p>\r\n<p>inside of hanlderAccepts it says&nbsp;<br>\r\n&nbsp;</p>\r\n<pre>return handler.accept.indexOf(cType.mediaType) &gt;= 0;</pre>\r\n<p>this throws an exception&nbsp; because ctype is null. it has no mediaType property,</p>\r\n<p>I fixed this in my environment by changing the code in handlerread (line 1283)&nbsp;from&nbsp;<br>\r\n&nbsp;</p>\r\n<pre>if (handlerAccepts(handler, cType)) {\r\n...\r\n}</pre>\r\n<p>to&nbsp;<br>\r\n&nbsp;</p>\r\n<pre>if (ctType != null &amp;&amp; handlerAccepts(handler, cType)) {\r\n...\r\n}</pre>\r\n<p>This works in my invironment, but obviously, is houldnt be changing the library to suit my own environment.</p>\r\n<p>has anyone used datajs to update existing items in a sharepoint list successfully?&nbsp; Do i need to write a custom handler to read the sharepoint response.</p>\r\n<p>&nbsp;</p>\r\n",
    "PostedDate": "2012-11-20T12:41:14.943-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]