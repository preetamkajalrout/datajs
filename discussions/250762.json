[
  {
    "Id": "584666",
    "ThreadId": "250762",
    "Html": "<p>Hello,</p>\n<p>i try to execute using datajs version 0.0.2 the following javascript for an update:</p>\n<div style=\"background-color: white; color: black;\">\n<pre><span style=\"color: blue;\">var</span> requestPut = {\r\n    headers: { <span style=\"color: #a31515;\">\"DataServiceVersion\"</span>: <span style=\"color: #a31515;\">\"2.0\"</span> },\r\n    method: <span style=\"color: #a31515;\">\"PUT\"</span>,  \r\n    requestUri: <span style=\"color: #a31515;\">\"http://localhost:2976/WcfDataService1.svc/Machines(1)\"</span>,\r\n    data: {\r\n        MachineName: <span style=\"color: #a31515;\">'Mixer'</span>\r\n    }\r\n}\r\nOData.request(\r\n    requestPut,\r\n    SuccessSingle\r\n);\r\n</pre>\n<pre>but i get this error message:&nbsp;</pre>\n</div>\n<div id=\"x_responsePlaceHolder\">ErrorHTTP request failed - {\"error\": {\"code\": \"\", \"message\": {\"lang\": \"en-GB\", \"value\": \"Error processing request stream. The property name 'results' specified for type 'DataModel.Machine' is not valid.\"}}}</div>\n<p>The 'results' is there in the json request (seen with Fiddler)...</p>\n<div><span lang=\"EN\">\n<p>{\"results\":[{\"MachineName\":\"Mixer\"}]}</p>\n<p><span lang=\"EN\"><span lang=\"EN\">For some reason this results is handled as a property of my Machine entity.</span></span></p>\n<p><span lang=\"EN\">On the same server, POST and DELETE work well for the same service:</span></p>\n<p><span lang=\"EN\"><span lang=\"EN\">&nbsp;</span></span></p>\n<div style=\"background-color: white; color: black;\">\n<pre>[JSONPSupportBehavior()]\r\n<span style=\"color: blue;\">public</span> <span style=\"color: blue;\">class</span> WcfDataService1 : DataService&lt;SdnODataEntities&gt;\r\n{\r\n    <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">static</span> <span style=\"color: blue;\">void</span> InitializeService(DataServiceConfiguration config)\r\n    {\r\n        config.SetEntitySetAccessRule(<span style=\"color: #a31515;\">\"*\"</span>, EntitySetRights.All);\r\n        config.SetEntitySetPageSize(<span style=\"color: #a31515;\">\"*\"</span>, 10);\r\n        config.DataServiceBehavior.MaxProtocolVersion = DataServiceProtocolVersion.V2;\r\n    }\r\n}\r\n</pre>\n<pre><span lang=\"EN\"><span lang=\"EN\">What could be wrong?</span></span></pre>\n</div>\n</span></div>",
    "PostedDate": "2011-03-22T15:59:08.69-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "585476",
    "ThreadId": "250762",
    "Html": "<p>svelde, this seems to be a problem with the JSON serializer. As a workaround, setting the DataServiceVersion header to \"1.0\" instead of \"2.0\" in your sample code should produce the right body - just let me know how this goes.</p>\r\n<p>I'll be opening an issue to track this to a fix.</p>\r\n<p>Thanks for reporting this!</p>\r\n<p>Marcelo</p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2011-03-23T21:51:45.77-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "585477",
    "ThreadId": "250762",
    "Html": "This discussion has been copied to a work item. Click <a href=\"http://datajs.codeplex.com/workitem/215\">here</a> to go to the work item and continue the discussion.",
    "PostedDate": "2011-03-23T21:53:51.783-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "585982",
    "ThreadId": "250762",
    "Html": "<p>i have tried the same example with 1.0 but this gave an error in the end.</p>\r\n<p>\r\n<script type=\"text/javascript\">// <![CDATA[Fiddler gives as request:]]></script>\r\n</p>\r\n<div style=\"color: black; background-color: white;\">\r\n<pre>PUT http://localhost:2976/WcfDataService1.svc/Machines(1) HTTP/1.1\r\nContent-Type: application/json\r\nAccept-Language: nl,en-US;q=0.5\r\ndataserviceversion: 1.0\r\nAccept: application/atomsvc+xml;q=0.8, application/json;q=0.5, */*;q=0.1\r\nReferer: http://localhost:2976/datajs_POST_HTMLPage.htm\r\nAccept-Encoding: gzip, deflate\r\nUser-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; .NET CLR 2.0.50727; .NET CLR 3.0.04506.30; .NET CLR 3.0.04506.648; .NET CLR 3.5.21022; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729; .NET4.0C; .NET4.0E)\r\nHost: localhost:2976\r\nContent-Length: 23\r\nConnection: Keep-Alive\r\nPragma: no-cache\r\n\r\n{\"MachineName\":\"Mixer\"}\r\n</pre>\r\n</div>\r\n<p>The response is:</p>\r\n<div style=\"color: black; background-color: white;\">\r\n<pre>HTTP/1.1 500 Internal Server Error\r\nCache-Control: no-cache\r\nContent-Length: 126\r\nContent-Type: application/json\r\nServer: Microsoft-IIS/7.5\r\nDataServiceVersion: 1.0;\r\nX-AspNet-Version: 4.0.30319\r\nX-SourceFiles: =?UTF-8?B?QzpcU0RFXFN0YXJ0XE9EYXRhU3RhcnRTb2x1dGlvblxXZWJBcHBsaWNhdGlvbjJcV2NmRGF0YVNlcnZpY2UxLnN2Y1xNYWNoaW5lcygxKQ==?=\r\nX-Powered-By: ASP.NET\r\nDate: Thu, 24 Mar 2011 19:28:31 GMT\r\n\r\n{\r\n\"error\": {\r\n\"code\": \"\", \"message\": {\r\n\"lang\": \"en-GB\", \"value\": \"An error occurred while processing this request.\"\r\n}\r\n}\r\n}\r\n</pre>\r\n</div>\r\n<p>The HTML is:</p>\r\n<div style=\"color: black; background-color: white;\">\r\n<pre><span style=\"color: blue;\">&lt;!</span><span style=\"color: #a31515;\">DOCTYPE</span> <span style=\"color: red;\">html</span> <span style=\"color: red;\">PUBLIC</span> <span style=\"color: blue;\">\"-//W3C//DTD XHTML 1.0 Transitional//EN\"</span> <span style=\"color: blue;\">\"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"</span><span style=\"color: blue;\">&gt;</span>\r\n<span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">html</span> <span style=\"color: red;\">xmlns</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"http://www.w3.org/1999/xhtml\"</span> <span style=\"color: blue;\">&gt;</span>\r\n\r\n<span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">head</span><span style=\"color: blue;\">&gt;</span>\r\n    <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">title</span><span style=\"color: blue;\">&gt;</span>Javascript Client Demo<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">title</span><span style=\"color: blue;\">&gt;</span>\r\n\r\n    <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">script</span> <span style=\"color: red;\">type</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"text/javascript\"</span> <span style=\"color: red;\">src</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"Scripts\\jquery-1.5.1.min.js\"</span><span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">script</span><span style=\"color: blue;\">&gt;</span>\r\n\t<span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">script</span> <span style=\"color: red;\">type</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"text/javascript\"</span> <span style=\"color: red;\">src</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"Scripts\\datajs-0.0.2.js\"</span><span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">script</span><span style=\"color: blue;\">&gt;</span> \r\n\t<span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">script</span> <span style=\"color: red;\">type</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"text/javascript\"</span> <span style=\"color: red;\">src</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"Scripts\\JScriptDatajsPost.js\"</span><span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">script</span><span style=\"color: blue;\">&gt;</span>    \r\n<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">head</span><span style=\"color: blue;\">&gt;</span>\r\n\r\n<span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">body</span><span style=\"color: blue;\">&gt;</span>\r\n    <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">div</span> <span style=\"color: red;\">id</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"responsePlaceHolder\"</span><span style=\"color: blue;\">&gt;</span>No results...<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">div</span><span style=\"color: blue;\">&gt;</span>\r\n\r\n    <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">script</span>  <span style=\"color: red;\">type</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"text/javascript\"</span><span style=\"color: blue;\">&gt;</span>\r\n        $(document).ready(<span style=\"color: blue;\">function</span> () {\r\n            PostRecords();\r\n        });\r\n    <span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">script</span><span style=\"color: blue;\">&gt;</span>\r\n<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">body</span><span style=\"color: blue;\">&gt;</span>\r\n<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">html</span><span style=\"color: blue;\">&gt;</span>\r\n</pre>\r\n</div>\r\n<p>The javascript run is:</p>\r\n<div style=\"color: black; background-color: white;\">\r\n<pre><span style=\"color: blue;\">function</span> PostRecords() {\r\n    $(<span style=\"color: #a31515;\">\"#responsePlaceHolder\"</span>).html(<span style=\"color: #a31515;\">\"&lt;div&gt;Posting To OData service...&lt;/div&gt;\"</span>);\r\n\r\n    OData.defaultError = <span style=\"color: blue;\">function</span> (err) {\r\n        $(<span style=\"color: #a31515;\">\"#responsePlaceHolder\"</span>).text(<span style=\"color: #a31515;\">\"Error\"</span> + err.message + <span style=\"color: #a31515;\">\" - \"</span> + err.response.body);\r\n    };\r\n\r\n    <span style=\"color: blue;\">var</span> requestPut = {\r\n        headers: { <span style=\"color: #a31515;\">\"DataServiceVersion\"</span>: <span style=\"color: #a31515;\">\"1.0\"</span> },\r\n        method: <span style=\"color: #a31515;\">\"PUT\"</span>,  \r\n        requestUri: <span style=\"color: #a31515;\">\"http://localhost:2976/WcfDataService1.svc/Machines(1)\"</span>,\r\n        data: {\r\n            MachineName: <span style=\"color: #a31515;\">'Mixer'</span>\r\n        }\r\n    }\r\n    OData.request(requestPut, SuccessSingle);\r\n}\r\n\r\n<span style=\"color: blue;\">function</span> SuccessSingle(data, response) {\r\n    <span style=\"color: blue;\">var</span> html = <span style=\"color: #a31515;\">\"SUCCESS\"</span>;\r\n\r\n    $(<span style=\"color: #a31515;\">\"#responsePlaceHolder\"</span>).html(html);\r\n}\r\n\r\n</pre>\r\n</div>\r\n<p>The service is:</p>\r\n<div style=\"color: black; background-color: white;\">\r\n<pre><span style=\"color: blue;\">using</span> System;\r\n<span style=\"color: blue;\">using</span> System.Collections.Generic;\r\n<span style=\"color: blue;\">using</span> System.Data.Services;\r\n<span style=\"color: blue;\">using</span> System.Data.Services.Common;\r\n<span style=\"color: blue;\">using</span> System.Linq;\r\n<span style=\"color: blue;\">using</span> System.ServiceModel.Web;\r\n<span style=\"color: blue;\">using</span> System.Web;\r\n<span style=\"color: blue;\">using</span> ClassLibrary1;\r\n<span style=\"color: blue;\">using</span> DataServicesJSONP;\r\n\r\n<span style=\"color: blue;\">namespace</span> WebApplication2\r\n{\r\n[JSONPSupportBehavior()]\r\n<span style=\"color: blue;\">public</span> <span style=\"color: blue;\">class</span> WcfDataService1 : DataService&lt;SdnODataEntities&gt;\r\n{\r\n    <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">static</span> <span style=\"color: blue;\">void</span> InitializeService(DataServiceConfiguration config)\r\n    {\r\n        config.SetEntitySetAccessRule(<span style=\"color: #a31515;\">\"*\"</span>, EntitySetRights.All);\r\n        config.SetEntitySetPageSize(<span style=\"color: #a31515;\">\"*\"</span>, 10);\r\n        config.DataServiceBehavior.MaxProtocolVersion = DataServiceProtocolVersion.V2;\r\n    }\r\n}\r\n}\r\n</pre>\r\n<pre>&nbsp;Note the JSONPSupportbehaviour...</pre>\r\n</div>\r\n<p>This runs in VS2010. The context is a EF4 context. The Database is Sql Server Express.</p>\r\n<p>On the same service the DataJs Get, Post and Delete are working fine. Also with jquery&nbsp;I can Get and Post new records. And a windows console applca can change a record in the same context...</p>\r\n<p>I try to write to a table:</p>\r\n<p>&nbsp;</p>\r\n<div style=\"color: black; background-color: white;\">\r\n<pre>\r\n<span style=\"color: blue;\">CREATE</span> <span style=\"color: blue;\">TABLE</span> [dbo].[Machines](\r\n\t[MachineId] [int] <span style=\"color: blue;\">IDENTITY</span>(1,1) <span style=\"color: blue;\">NOT</span> <span style=\"color: blue;\">NULL</span>,\r\n\t[MachineName] [nvarchar](50) <span style=\"color: blue;\">NOT</span> <span style=\"color: blue;\">NULL</span>,\r\n\t[SupervisorName] [nvarchar](50) <span style=\"color: blue;\">NOT</span> <span style=\"color: blue;\">NULL</span>,\r\n\t[Image] [image] <span style=\"color: blue;\">NULL</span>,\r\n\t[ImageName] [nvarchar](50) <span style=\"color: blue;\">NULL</span>,\r\n <span style=\"color: blue;\">CONSTRAINT</span> [PK__Machines__44EE5B3807020F21] <span style=\"color: blue;\">PRIMARY</span> <span style=\"color: blue;\">KEY</span> <span style=\"color: blue;\">CLUSTERED</span> \r\n(\r\n\t[MachineId] <span style=\"color: blue;\">ASC</span>\r\n)<span style=\"color: blue;\">WITH</span> (PAD_INDEX  = <span style=\"color: blue;\">OFF</span>, STATISTICS_NORECOMPUTE  = <span style=\"color: blue;\">OFF</span>, IGNORE_DUP_KEY = <span style=\"color: blue;\">OFF</span>, ALLOW_ROW_LOCKS  = <span style=\"color: blue;\">ON</span>, ALLOW_PAGE_LOCKS  = <span style=\"color: blue;\">ON</span>) <span style=\"color: blue;\">ON</span> [PRIMARY]\r\n) <span style=\"color: blue;\">ON</span> [PRIMARY] TEXTIMAGE_ON [PRIMARY]\r\n</pre>\r\n<pre>And the record is available in the database...</pre>\r\n<pre>Any ideas?</pre>\r\n</div>\r\n<p>&nbsp;</p>\r\n<p>\r\n<script type=\"text/javascript\"></script>\r\n<!--         $(document).ready(function () {             PostRecords();         }); // --></p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2011-03-24T12:51:30.703-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "585996",
    "ThreadId": "250762",
    "Html": "<p>From a first quick look, PUT implies replacing an entity with another one, so the missing properties are getting reset, which the database schema doesn&rsquo;t seem to allow. If this is the case, changing PUT to MERGE would do the trick. Browsers may not allow the use of MERGE, so you can set up the request like this.</p>\r\n<p><br />var request = {<br />&nbsp; ...<br />&nbsp; method: \"POST\",<br />&nbsp; headers: {<br />&nbsp; &nbsp; ...<br />&nbsp;&nbsp;&nbsp; \"X-HTTP-Method\": \"MERGE\"<br />&nbsp; }<br />};</p>\r\n<p>Also, you can get more details in the error by setting the UseVerboseErrors property to true on the configuration object during service initialization (be sure to turn it off after debugging though). This should help verify whether this is really a problem of trying to PUT an entity like that.</p>\r\n<p><br />Marcelo</p>",
    "PostedDate": "2011-03-24T13:10:12.113-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "586095",
    "ThreadId": "250762",
    "Html": "<p>Yes, this works better, nice.</p>\n<p>Yes, merge should be a better description for the code i wanted to execute...</p>\n<p>This is what i have seen now:</p>\n<ul>\n<li>The UseVerboseErrors pointed me to the not null column \"SupervisorName\"&nbsp;which i did not fill in during the PUT. </li>\n<li>The PUT works correct by filling in the correct values and setting NULL in all colums of which no value is passed. </li>\n<li>The MERGE method functions well by just updating the correct columns in the record and not changing the other columns </li>\n</ul>\n<p>This all works well for PUT and with ﻿DataServiceFunction set to 1.0 or leaving the header entry away. And this is also the case for the MERGE.</p>\n<p><strong>The ﻿﻿DataServiceVersion set to 2.0 still gives the same error (as seen in the first post) in both situations.</strong></p>\n<p>I had looked at the Merge before but&nbsp;the usage of it&nbsp;was not clear to me in the <a title=\"documentation\" href=\"http://datajs.codeplex.com/documentation\" target=\"_blank\">documentation</a></p>\n<p>I expected the merge to be like</p>\n<div style=\"background-color: white; color: black;\">\n<pre>    <span style=\"color: blue;\">var</span> requestPut = {\r\n        method: <span style=\"color: #a31515;\">\"MERGE\"</span>,\r\n        requestUri: <span style=\"color: #a31515;\">\"http://localhost:2976/WcfDataService1.svc/Machines(33)\"</span>,\r\n        data: {\r\n            MachineName: <span style=\"color: #a31515;\">'Mixer'</span>\r\n        }\r\n    }\r\n</pre>\n<pre>This is just a little bit more intuitive instead of ﻿X-HTTP-Method :-)</pre>\n<pre>Thanks for the quick answers.</pre>\n</div>",
    "PostedDate": "2011-03-24T15:40:25.233-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "586116",
    "ThreadId": "250762",
    "Html": "<p>I'm happy to have been able to help - I'll try and incorporate some of this in our documentation Wiki.</p>\r\n<p>Just as a point of note, we had at some point considered allowing the syntax you mentioned, but unfortunately we can't detect automatically whether it's safe to do a MERGE or whether we should do a POST with the header instead. MERGE has the problem that many HTTP processors along the way may refuse to deal with it (including some browsers!), and POST has the problem that if the server isn't looking out for the header, we may do something different than what was intended or simply fail.</p>\r\n<p>Our current thinking is that at some point we'll develop a higher-level API that is provides a per-site configuration point where apps can set which behavior they prefer, along with all other optional per-server capabilities that are hard or impossible to determine directly at runtime.</p>\r\n<p>The DSV thing is just a bug we need to fix, hopefully we can get this resolved soon.</p>\r\n<p>Thanks again for hanging on and all your valuable feedback!</p>\r\n<p>Marcelo</p>",
    "PostedDate": "2011-03-24T16:26:04.45-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]