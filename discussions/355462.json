[
  {
    "Id": "835131",
    "ThreadId": "355462",
    "Html": "\r\n<p>Hi Alex,</p>\r\n<p>I use now datajs to do change requests with atom/XML requests as you described in the last thread (I use the ODataAtomHandler now). Now I ran into the problem when doing delete requests.</p>\r\n<p>The server responds with 204 and has no content and no content type set in the response. That's ok. But in that case datajs calls the error handler because it crashed in the</p>\r\n<p>var handlerRead = function (handler, parseCallback, response, context) {</p>\r\n<p>if (!response || !response.headers) {<br>\r\nreturn false;<br>\r\n}<br>\r\n<br>\r\nvar cType = getContentType(response);<br>\r\nvar version = getDataServiceVersion(response) || &quot;&quot;;<br>\r\nvar body = response.body;<br>\r\n<br>\r\nif (!assigned(body)) {<br>\r\nreturn false;<br>\r\n}<br>\r\n<br>\r\n&nbsp;if (handlerAccepts(handler, cType)) { &lt;-- crash here because no ctype<br>\r\nvar readContext = createReadWriteContext(cType, version, context, handler);<br>\r\nreadContext.response = response;<br>\r\nresponse.data = parseCallback(handler, body, readContext);<br>\r\nreturn response.data !== undefined;<br>\r\n}<br>\r\n<br>\r\nreturn false;</p>\r\n<p>}</p>\r\n<p>function.</p>\r\n<p>&nbsp;It works when using the defaultHandler but not the atomHandler.</p>\r\n<p>When I add an additional check:</p>\r\n<p>if (!response || !response.headers || !response.body) {<br>\r\nreturn false;<br>\r\n}</p>\r\n<p>&nbsp;it works fine and the successHandler is called correctly.</p>\r\n<p>The default handler code doesn't call this function at all because there is a check before in this function:</p>\r\n<p>odata.defaultHandler = {<br>\r\nread: function (response, context) {<br>\r\n/// &lt;summary&gt;Reads the body of the specified response by delegating to JSON and ATOM handlers.&lt;/summary&gt;<br>\r\n/// &lt;param name=&quot;response&quot;&gt;Response object.&lt;/param&gt;<br>\r\n/// &lt;param name=&quot;context&quot;&gt;Operation context.&lt;/param&gt;<br>\r\n<br>\r\nif (response &amp;&amp; assigned(response.body) &amp;&amp; response.headers[&quot;Content-Type&quot;]) {<br>\r\ndispatchHandler(&quot;read&quot;, response, context);<br>\r\n}<br>\r\n},</p>\r\n<p>&nbsp;where the readHandler isn't called at all when there is no response body/content type.</p>\r\n<p>Could you please check that? I was trying that with the normal</p>\r\n<p>http://services.odata.org/%28S%28readwrite%29%29/OData/OData.svc/</p>\r\n<p>server.</p>\r\n<p>&nbsp;</p>\r\n<p>Thanks!</p>\r\n<p>Joe</p>\r\n<p>&nbsp;</p>\r\n",
    "PostedDate": "2012-05-11T07:12:05.947-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "835327",
    "ThreadId": "355462",
    "Html": "<p>Hi Joe,</p>\r\n<p>&nbsp;&nbsp; Thanks for reporting this I will take a look into it.&nbsp;What strikes me is that the lines:</p>\r\n<p>&nbsp;&nbsp; if (!assigned(body)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false;<br />&nbsp;&nbsp; }&nbsp;</p>\r\n<p>&nbsp;&nbsp; Should prevent the handler form taking any more action with the response.&nbsp; Can you share a trace of the request and the response?&nbsp; I'm intrigued to see why body is not null or undefined.</p>\r\n<p>&nbsp;&nbsp; For the time being I think you can do the following in your web app initialization to unblock you, if you want to use the atomHandler:&nbsp;&nbsp;&nbsp;</p>\r\n<div style=\"color: black; background-color: white;\">\r\n<pre>OData.atomHandler.read = (<span style=\"color: blue;\">function</span> () {\r\n    <span style=\"color: blue;\">var</span> atomReadFunction = OData.atomHandler.read;\r\n    <span style=\"color: blue;\">return</span> <span style=\"color: blue;\">function</span> (response, context) {\r\n        <span style=\"color: blue;\">if</span> (response.headers[<span style=\"color: #a31515;\">\"Content-Type\"</span>]) {\r\n            <span style=\"color: blue;\">return</span> atomReadFunction.call(OData.atomHandler, response, context);\r\n        }\r\n    }\r\n})();\r\n\r\n</pre>\r\n</div>\r\n<p>Regards,</p>\r\n<p>Alex Trigo</p>",
    "PostedDate": "2012-05-11T15:29:02.52-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "835951",
    "ThreadId": "355462",
    "Html": "<p>Hi Alex,</p>\r\n<p>thanks!</p>\r\n<p>here is the trace. I also debugged and the response.body is \"\" so &nbsp;!assigned(body) is false.</p>\r\n<p>var body = response.body;<br /><br /> if (!assigned(body)) {<br /> return false;<br /> }</p>\r\n<p>{<br /> \"startedDateTime\": \"2012-05-14T09:03:41.009Z\",<br /> \"time\": 206,<br /> \"request\": {<br /> \"method\": \"DELETE\",<br /> \"url\": \"http://services.odata.org/(S(ldwmozatefmdqx1gcyjqt000))/OData/OData.svc/Products(6)\",<br /> \"httpVersion\": \"HTTP/1.1\",<br /> \"headers\": [<br /> {<br /> \"name\": \"Origin\",<br /> \"value\": \"http://localhost:8080\"<br /> },<br /> {<br /> \"name\": \"Accept-Encoding\",<br /> \"value\": \"gzip,deflate,sdch\"<br /> },<br /> {<br /> \"name\": \"Accept-Language\",<br /> \"value\": \"en-US,en;q=0.8\"<br /> },<br /> {<br /> \"name\": \"Connection\",<br /> \"value\": \"keep-alive\"<br /> },<br /> {<br /> \"name\": \"MaxDataServiceVersion\",<br /> \"value\": \"2.0\"<br /> },<br /> {<br /> \"name\": \"Accept-Charset\",<br /> \"value\": \"ISO-8859-1,utf-8;q=0.7,*;q=0.3\"<br /> },<br /> {<br /> \"name\": \"Host\",<br /> \"value\": \"localhost:8080\"<br /> },<br /> {<br /> \"name\": \"User-Agent\",<br /> \"value\": \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.19 (KHTML, like Gecko) Chrome/18.0.1025.168 Safari/535.19\"<br /> },<br /> {<br /> \"name\": \"Accept\",<br /> \"value\": \"application/atom+xml,application/atomsvc+xml,application/xml\"<br /> },<br /> {<br /> \"name\": \"Referer\",<br /> \"value\": \"http://localhost:8080/test/ODataWrite.html\"<br /> },<br /> {<br /> \"name\": \"DataServiceVersion\",<br /> \"value\": \"2.0\"<br /> }<br /> ],<br /> \"queryString\": [],<br /> \"cookies\": [],<br /> \"headersSize\": 626,<br /> \"bodySize\": 0<br /> },<br /> \"response\": {<br /> \"status\": 204,<br /> \"statusText\": \"No Content\",<br /> \"httpVersion\": \"HTTP/1.1\",<br /> \"headers\": [<br /> {<br /> \"name\": \"Date\",<br /> \"value\": \"Mon, 14 May 2012 09:03:41 GMT\"<br /> },<br /> {<br /> \"name\": \"X-AspNet-Version\",<br /> \"value\": \"4.0.30319\"<br /> },<br /> {<br /> \"name\": \"X-Powered-By\",<br /> \"value\": \"ASP.NET\"<br /> },<br /> {<br /> \"name\": \"Connection\",<br /> \"value\": \"Keep-Alive\"<br /> },<br /> {<br /> \"name\": \"Server\",<br /> \"value\": \"Microsoft-IIS/7.5\"<br /> },<br /> {<br /> \"name\": \"Cache-Control\",<br /> \"value\": \"no-cache\"<br /> },<br /> {<br /> \"name\": \"DataServiceVersion\",<br /> \"value\": \"1.0;\"<br /> }<br /> ],<br /> \"cookies\": [],<br /> \"content\": {<br /> \"size\": 0,<br /> \"mimeType\": \"text/plain\",<br /> \"compression\": 0<br /> },<br /> \"redirectURL\": \"\",<br /> \"headersSize\": 218,<br /> \"bodySize\": 0<br /> },<br /> \"cache\": {},<br /> \"timings\": {<br /> \"blocked\": 0,<br /> \"dns\": -1,<br /> \"connect\": -1,<br /> \"send\": 0,<br /> \"wait\": 200,<br /> \"receive\": 6,<br /> \"ssl\": -1<br /> },<br /> \"pageref\": \"page_7\"<br />}</p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2012-05-14T02:09:51.027-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]